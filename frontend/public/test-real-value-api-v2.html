<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MKM Lab 실제값 API 테스트 v2</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            font-size: 2.5em;
            margin: 0;
            background: linear-gradient(45deg, #00d4ff, #ff00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .status-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .status-card.online {
            border-color: #00ff88;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
        }
        .status-card.offline {
            border-color: #ff4444;
            box-shadow: 0 0 20px rgba(255, 68, 68, 0.3);
        }
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .test-section h3 {
            color: #00d4ff;
            margin-top: 0;
        }
        .btn {
            background: linear-gradient(45deg, #00d4ff, #0099cc);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: all 0.3s ease;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 212, 255, 0.4);
        }
        .btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }
        .result-box {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { color: #00ff88; }
        .error { color: #ff4444; }
        .info { color: #00d4ff; }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #00d4ff, #00ff88);
            width: 0%;
            transition: width 0.3s ease;
        }
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .metric {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }
        .metric-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #00d4ff;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🔬 MKM Lab 실제값 API 테스트 v2</h1>
        <p>시뮬레이션이 아닌 실제 백엔드 알고리즘 기반 건강 분석 시스템</p>
    </div>

    <div class="container">
        <h2>📡 서버 연결 상태</h2>
        <div class="status-grid">
            <div class="status-card" id="backend-status">
                <h3>백엔드 서버</h3>
                <p id="backend-text">확인 중...</p>
            </div>
            <div class="status-card" id="frontend-status">
                <h3>프론트엔드 서버</h3>
                <p id="frontend-text">확인 중...</p>
            </div>
        </div>
    </div>

    <div class="container">
        <h2>🔄 서버 상태 확인</h2>
        <button class="btn" onclick="checkAllServers()">전체 서버 상태 확인</button>
        <div class="result-box" id="server-status-result"></div>
    </div>

    <div class="container">
        <h2>💓 RPPG 실제값 API 테스트</h2>
        <p>실제 비디오 데이터로 RPPG API를 테스트합니다.</p>
        <button class="btn" onclick="testRPPGAPI()">RPPG API 테스트</button>
        <div class="result-box" id="rppg-result"></div>
    </div>

    <div class="container">
        <h2>🎵 음성 분석 실제값 API 테스트</h2>
        <p>실제 오디오 데이터로 음성 분석 API를 테스트합니다.</p>
        <button class="btn" onclick="testVoiceAPI()">음성 분석 API 테스트</button>
        <div class="result-box" id="voice-result"></div>
    </div>

    <div class="container">
        <h2>📊 전체 시스템 테스트</h2>
        <p>모든 API를 순차적으로 테스트합니다.</p>
        <button class="btn" onclick="runFullSystemTest()">전체 테스트 실행</button>
        <div class="progress-bar">
            <div class="progress-fill" id="test-progress"></div>
        </div>
        <div class="result-box" id="full-test-result"></div>
    </div>

    <script>
        class RealValueAPITesterV2 {
            constructor() {
                this.baseURL = 'http://localhost:8000';
                this.frontendURL = 'http://localhost:3000';
                this.testResults = {
                    backend: false,
                    rppg: false,
                    voice: false
                };
            }

            async checkServerHealth(url, name) {
                try {
                    const response = await fetch(url, { 
                        method: 'GET',
                        signal: AbortSignal.timeout(5000)
                    });
                    return response.ok;
                } catch (error) {
                    console.error(`${name} 서버 확인 실패:`, error);
                    return false;
                }
            }

            async checkAllServers() {
                const resultDiv = document.getElementById('server-status-result');
                resultDiv.innerHTML = '🔄 서버 상태 확인 중...\n';

                // 백엔드 서버 확인
                const backendOnline = await this.checkServerHealth(`${this.baseURL}/api/v1/health`, '백엔드');
                this.updateStatusCard('backend-status', backendOnline, '백엔드 서버');
                this.testResults.backend = backendOnline;

                // 프론트엔드 서버 확인
                const frontendOnline = await this.checkServerHealth(this.frontendURL, '프론트엔드');
                this.updateStatusCard('frontend-status', frontendOnline, '프론트엔드 서버');

                resultDiv.innerHTML = `✅ 백엔드 서버: ${backendOnline ? '온라인' : '오프라인'}\n`;
                resultDiv.innerHTML += `✅ 프론트엔드 서버: ${frontendOnline ? '온라인' : '오프라인'}\n`;

                if (backendOnline && frontendOnline) {
                    resultDiv.innerHTML += '\n🎉 모든 서버가 정상 동작 중입니다!\n';
                } else {
                    resultDiv.innerHTML += '\n⚠️ 일부 서버에 문제가 있습니다.\n';
                }
            }

            updateStatusCard(cardId, isOnline, serverName) {
                const card = document.getElementById(cardId);
                const textElement = card.querySelector('p');
                
                if (isOnline) {
                    card.className = 'status-card online';
                    textElement.textContent = '✅ 온라인';
                    textElement.className = 'success';
                } else {
                    card.className = 'status-card offline';
                    textElement.textContent = '❌ 오프라인';
                    textElement.className = 'error';
                }
            }

            async testRPPGAPI() {
                const resultDiv = document.getElementById('rppg-result');
                resultDiv.innerHTML = '🧪 RPPG API 테스트 중...\n';

                try {
                    // 테스트 비디오 데이터 생성 (1MB)
                    const testVideoData = new Uint8Array(1024 * 1024);
                    for (let i = 0; i < testVideoData.length; i++) {
                        testVideoData[i] = Math.floor(Math.random() * 256);
                    }

                    const formData = new FormData();
                    formData.append('video_file', new Blob([testVideoData], { type: 'video/mp4' }), 'test_video.mp4');
                    formData.append('user_id', 'test_user');
                    formData.append('frame_count', '300');

                    const response = await fetch(`${this.baseURL}/api/v1/measure/rppg`, {
                        method: 'POST',
                        body: formData,
                        signal: AbortSignal.timeout(30000)
                    });

                    if (response.ok) {
                        const data = await response.json();
                        this.testResults.rppg = true;
                        resultDiv.innerHTML = `✅ RPPG API 테스트 성공!\n\n응답 데이터:\n${JSON.stringify(data, null, 2)}`;
                        resultDiv.className = 'result-box success';
                    } else {
                        const errorData = await response.json();
                        resultDiv.innerHTML = `❌ RPPG API 테스트 실패: ${response.status}\n\n오류 정보:\n${JSON.stringify(errorData, null, 2)}`;
                        resultDiv.className = 'result-box error';
                    }
                } catch (error) {
                    resultDiv.innerHTML = `❌ RPPG API 테스트 실패: ${error.message}`;
                    resultDiv.className = 'result-box error';
                }
            }

            async testVoiceAPI() {
                const resultDiv = document.getElementById('voice-result');
                resultDiv.innerHTML = '🧪 음성 분석 API 테스트 중...\n';

                try {
                    // 테스트 오디오 데이터 생성 (882KB)
                    const testAudioData = new Uint8Array(882 * 1024);
                    for (let i = 0; i < testAudioData.length; i++) {
                        testAudioData[i] = Math.floor(Math.random() * 256);
                    }

                    const formData = new FormData();
                    formData.append('audio_file', new Blob([testAudioData], { type: 'audio/wav' }), 'test_audio.wav');
                    formData.append('user_id', 'test_user');
                    formData.append('duration', '5.0');

                    const response = await fetch(`${this.baseURL}/api/v1/measure/voice`, {
                        method: 'POST',
                        body: formData,
                        signal: AbortSignal.timeout(30000)
                    });

                    if (response.ok) {
                        const data = await response.json();
                        this.testResults.voice = true;
                        resultDiv.innerHTML = `✅ 음성 분석 API 테스트 성공!\n\n응답 데이터:\n${JSON.stringify(data, null, 2)}`;
                        resultDiv.className = 'result-box success';
                    } else {
                        const errorData = await response.json();
                        resultDiv.innerHTML = `❌ 음성 분석 API 테스트 실패: ${response.status}\n\n오류 정보:\n${JSON.stringify(errorData, null, 2)}`;
                        resultDiv.className = 'result-box error';
                    }
                } catch (error) {
                    resultDiv.innerHTML = `❌ 음성 분석 API 테스트 실패: ${error.message}`;
                    resultDiv.className = 'result-box error';
                }
            }

            async runFullSystemTest() {
                const resultDiv = document.getElementById('full-test-result');
                const progressBar = document.getElementById('test-progress');
                
                resultDiv.innerHTML = '🚀 전체 시스템 테스트 시작...\n\n';
                progressBar.style.width = '0%';

                const tests = [
                    { name: '서버 상태 확인', test: () => this.checkAllServers() },
                    { name: 'RPPG API 테스트', test: () => this.testRPPGAPI() },
                    { name: '음성 분석 API 테스트', test: () => this.testVoiceAPI() }
                ];

                let passedTests = 0;
                const totalTests = tests.length;

                for (let i = 0; i < tests.length; i++) {
                    const test = tests[i];
                    resultDiv.innerHTML += `${i + 1}️⃣ ${test.name} 중...\n`;
                    
                    try {
                        await test.test();
                        passedTests++;
                        resultDiv.innerHTML += `   ${test.name}: ✅ 성공\n`;
                    } catch (error) {
                        resultDiv.innerHTML += `   ${test.name}: ❌ 실패 - ${error.message}\n`;
                    }

                    // 진행률 업데이트
                    const progress = ((i + 1) / totalTests) * 100;
                    progressBar.style.width = `${progress}%`;
                }

                resultDiv.innerHTML += `\n🎯 최종 결과: ${passedTests}/${totalTests} 테스트 통과\n\n`;
                
                if (passedTests === totalTests) {
                    resultDiv.innerHTML += '🎉 모든 테스트가 성공했습니다! 실제값 시스템이 정상적으로 작동합니다.\n';
                    resultDiv.className = 'result-box success';
                } else {
                    resultDiv.innerHTML += `⚠️ ${totalTests - passedTests}개 테스트가 실패했습니다.\n`;
                    resultDiv.className = 'result-box error';
                }
            }
        }

        // 전역 함수들
        const tester = new RealValueAPITesterV2();

        function checkAllServers() {
            tester.checkAllServers();
        }

        function testRPPGAPI() {
            tester.testRPPGAPI();
        }

        function testVoiceAPI() {
            tester.testVoiceAPI();
        }

        function runFullSystemTest() {
            tester.runFullSystemTest();
        }

        // 페이지 로드 시 자동으로 서버 상태 확인
        window.addEventListener('load', () => {
            tester.checkAllServers();
        });
    </script>
</body>
</html> 