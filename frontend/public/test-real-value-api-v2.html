<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MKM Lab ì‹¤ì œê°’ API í…ŒìŠ¤íŠ¸ v2</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            font-size: 2.5em;
            margin: 0;
            background: linear-gradient(45deg, #00d4ff, #ff00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .status-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .status-card.online {
            border-color: #00ff88;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
        }
        .status-card.offline {
            border-color: #ff4444;
            box-shadow: 0 0 20px rgba(255, 68, 68, 0.3);
        }
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .test-section h3 {
            color: #00d4ff;
            margin-top: 0;
        }
        .btn {
            background: linear-gradient(45deg, #00d4ff, #0099cc);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: all 0.3s ease;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 212, 255, 0.4);
        }
        .btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }
        .result-box {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { color: #00ff88; }
        .error { color: #ff4444; }
        .info { color: #00d4ff; }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #00d4ff, #00ff88);
            width: 0%;
            transition: width 0.3s ease;
        }
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .metric {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }
        .metric-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #00d4ff;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ”¬ MKM Lab ì‹¤ì œê°’ API í…ŒìŠ¤íŠ¸ v2</h1>
        <p>ì‹œë®¬ë ˆì´ì…˜ì´ ì•„ë‹Œ ì‹¤ì œ ë°±ì—”ë“œ ì•Œê³ ë¦¬ì¦˜ ê¸°ë°˜ ê±´ê°• ë¶„ì„ ì‹œìŠ¤í…œ</p>
    </div>

    <div class="container">
        <h2>ğŸ“¡ ì„œë²„ ì—°ê²° ìƒíƒœ</h2>
        <div class="status-grid">
            <div class="status-card" id="backend-status">
                <h3>ë°±ì—”ë“œ ì„œë²„</h3>
                <p id="backend-text">í™•ì¸ ì¤‘...</p>
            </div>
            <div class="status-card" id="frontend-status">
                <h3>í”„ë¡ íŠ¸ì—”ë“œ ì„œë²„</h3>
                <p id="frontend-text">í™•ì¸ ì¤‘...</p>
            </div>
        </div>
    </div>

    <div class="container">
        <h2>ğŸ”„ ì„œë²„ ìƒíƒœ í™•ì¸</h2>
        <button class="btn" onclick="checkAllServers()">ì „ì²´ ì„œë²„ ìƒíƒœ í™•ì¸</button>
        <div class="result-box" id="server-status-result"></div>
    </div>

    <div class="container">
        <h2>ğŸ’“ RPPG ì‹¤ì œê°’ API í…ŒìŠ¤íŠ¸</h2>
        <p>ì‹¤ì œ ë¹„ë””ì˜¤ ë°ì´í„°ë¡œ RPPG APIë¥¼ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
        <button class="btn" onclick="testRPPGAPI()">RPPG API í…ŒìŠ¤íŠ¸</button>
        <div class="result-box" id="rppg-result"></div>
    </div>

    <div class="container">
        <h2>ğŸµ ìŒì„± ë¶„ì„ ì‹¤ì œê°’ API í…ŒìŠ¤íŠ¸</h2>
        <p>ì‹¤ì œ ì˜¤ë””ì˜¤ ë°ì´í„°ë¡œ ìŒì„± ë¶„ì„ APIë¥¼ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
        <button class="btn" onclick="testVoiceAPI()">ìŒì„± ë¶„ì„ API í…ŒìŠ¤íŠ¸</button>
        <div class="result-box" id="voice-result"></div>
    </div>

    <div class="container">
        <h2>ğŸ“Š ì „ì²´ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</h2>
        <p>ëª¨ë“  APIë¥¼ ìˆœì°¨ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
        <button class="btn" onclick="runFullSystemTest()">ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
        <div class="progress-bar">
            <div class="progress-fill" id="test-progress"></div>
        </div>
        <div class="result-box" id="full-test-result"></div>
    </div>

    <script>
        class RealValueAPITesterV2 {
            constructor() {
                this.baseURL = 'http://localhost:8000';
                this.frontendURL = 'http://localhost:3000';
                this.testResults = {
                    backend: false,
                    rppg: false,
                    voice: false
                };
            }

            async checkServerHealth(url, name) {
                try {
                    const response = await fetch(url, { 
                        method: 'GET',
                        signal: AbortSignal.timeout(5000)
                    });
                    return response.ok;
                } catch (error) {
                    console.error(`${name} ì„œë²„ í™•ì¸ ì‹¤íŒ¨:`, error);
                    return false;
                }
            }

            async checkAllServers() {
                const resultDiv = document.getElementById('server-status-result');
                resultDiv.innerHTML = 'ğŸ”„ ì„œë²„ ìƒíƒœ í™•ì¸ ì¤‘...\n';

                // ë°±ì—”ë“œ ì„œë²„ í™•ì¸
                const backendOnline = await this.checkServerHealth(`${this.baseURL}/api/v1/health`, 'ë°±ì—”ë“œ');
                this.updateStatusCard('backend-status', backendOnline, 'ë°±ì—”ë“œ ì„œë²„');
                this.testResults.backend = backendOnline;

                // í”„ë¡ íŠ¸ì—”ë“œ ì„œë²„ í™•ì¸
                const frontendOnline = await this.checkServerHealth(this.frontendURL, 'í”„ë¡ íŠ¸ì—”ë“œ');
                this.updateStatusCard('frontend-status', frontendOnline, 'í”„ë¡ íŠ¸ì—”ë“œ ì„œë²„');

                resultDiv.innerHTML = `âœ… ë°±ì—”ë“œ ì„œë²„: ${backendOnline ? 'ì˜¨ë¼ì¸' : 'ì˜¤í”„ë¼ì¸'}\n`;
                resultDiv.innerHTML += `âœ… í”„ë¡ íŠ¸ì—”ë“œ ì„œë²„: ${frontendOnline ? 'ì˜¨ë¼ì¸' : 'ì˜¤í”„ë¼ì¸'}\n`;

                if (backendOnline && frontendOnline) {
                    resultDiv.innerHTML += '\nğŸ‰ ëª¨ë“  ì„œë²„ê°€ ì •ìƒ ë™ì‘ ì¤‘ì…ë‹ˆë‹¤!\n';
                } else {
                    resultDiv.innerHTML += '\nâš ï¸ ì¼ë¶€ ì„œë²„ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.\n';
                }
            }

            updateStatusCard(cardId, isOnline, serverName) {
                const card = document.getElementById(cardId);
                const textElement = card.querySelector('p');
                
                if (isOnline) {
                    card.className = 'status-card online';
                    textElement.textContent = 'âœ… ì˜¨ë¼ì¸';
                    textElement.className = 'success';
                } else {
                    card.className = 'status-card offline';
                    textElement.textContent = 'âŒ ì˜¤í”„ë¼ì¸';
                    textElement.className = 'error';
                }
            }

            async testRPPGAPI() {
                const resultDiv = document.getElementById('rppg-result');
                resultDiv.innerHTML = 'ğŸ§ª RPPG API í…ŒìŠ¤íŠ¸ ì¤‘...\n';

                try {
                    // í…ŒìŠ¤íŠ¸ ë¹„ë””ì˜¤ ë°ì´í„° ìƒì„± (1MB)
                    const testVideoData = new Uint8Array(1024 * 1024);
                    for (let i = 0; i < testVideoData.length; i++) {
                        testVideoData[i] = Math.floor(Math.random() * 256);
                    }

                    const formData = new FormData();
                    formData.append('video_file', new Blob([testVideoData], { type: 'video/mp4' }), 'test_video.mp4');
                    formData.append('user_id', 'test_user');
                    formData.append('frame_count', '300');

                    const response = await fetch(`${this.baseURL}/api/v1/measure/rppg`, {
                        method: 'POST',
                        body: formData,
                        signal: AbortSignal.timeout(30000)
                    });

                    if (response.ok) {
                        const data = await response.json();
                        this.testResults.rppg = true;
                        resultDiv.innerHTML = `âœ… RPPG API í…ŒìŠ¤íŠ¸ ì„±ê³µ!\n\nì‘ë‹µ ë°ì´í„°:\n${JSON.stringify(data, null, 2)}`;
                        resultDiv.className = 'result-box success';
                    } else {
                        const errorData = await response.json();
                        resultDiv.innerHTML = `âŒ RPPG API í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${response.status}\n\nì˜¤ë¥˜ ì •ë³´:\n${JSON.stringify(errorData, null, 2)}`;
                        resultDiv.className = 'result-box error';
                    }
                } catch (error) {
                    resultDiv.innerHTML = `âŒ RPPG API í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`;
                    resultDiv.className = 'result-box error';
                }
            }

            async testVoiceAPI() {
                const resultDiv = document.getElementById('voice-result');
                resultDiv.innerHTML = 'ğŸ§ª ìŒì„± ë¶„ì„ API í…ŒìŠ¤íŠ¸ ì¤‘...\n';

                try {
                    // í…ŒìŠ¤íŠ¸ ì˜¤ë””ì˜¤ ë°ì´í„° ìƒì„± (882KB)
                    const testAudioData = new Uint8Array(882 * 1024);
                    for (let i = 0; i < testAudioData.length; i++) {
                        testAudioData[i] = Math.floor(Math.random() * 256);
                    }

                    const formData = new FormData();
                    formData.append('audio_file', new Blob([testAudioData], { type: 'audio/wav' }), 'test_audio.wav');
                    formData.append('user_id', 'test_user');
                    formData.append('duration', '5.0');

                    const response = await fetch(`${this.baseURL}/api/v1/measure/voice`, {
                        method: 'POST',
                        body: formData,
                        signal: AbortSignal.timeout(30000)
                    });

                    if (response.ok) {
                        const data = await response.json();
                        this.testResults.voice = true;
                        resultDiv.innerHTML = `âœ… ìŒì„± ë¶„ì„ API í…ŒìŠ¤íŠ¸ ì„±ê³µ!\n\nì‘ë‹µ ë°ì´í„°:\n${JSON.stringify(data, null, 2)}`;
                        resultDiv.className = 'result-box success';
                    } else {
                        const errorData = await response.json();
                        resultDiv.innerHTML = `âŒ ìŒì„± ë¶„ì„ API í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${response.status}\n\nì˜¤ë¥˜ ì •ë³´:\n${JSON.stringify(errorData, null, 2)}`;
                        resultDiv.className = 'result-box error';
                    }
                } catch (error) {
                    resultDiv.innerHTML = `âŒ ìŒì„± ë¶„ì„ API í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`;
                    resultDiv.className = 'result-box error';
                }
            }

            async runFullSystemTest() {
                const resultDiv = document.getElementById('full-test-result');
                const progressBar = document.getElementById('test-progress');
                
                resultDiv.innerHTML = 'ğŸš€ ì „ì²´ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì‹œì‘...\n\n';
                progressBar.style.width = '0%';

                const tests = [
                    { name: 'ì„œë²„ ìƒíƒœ í™•ì¸', test: () => this.checkAllServers() },
                    { name: 'RPPG API í…ŒìŠ¤íŠ¸', test: () => this.testRPPGAPI() },
                    { name: 'ìŒì„± ë¶„ì„ API í…ŒìŠ¤íŠ¸', test: () => this.testVoiceAPI() }
                ];

                let passedTests = 0;
                const totalTests = tests.length;

                for (let i = 0; i < tests.length; i++) {
                    const test = tests[i];
                    resultDiv.innerHTML += `${i + 1}ï¸âƒ£ ${test.name} ì¤‘...\n`;
                    
                    try {
                        await test.test();
                        passedTests++;
                        resultDiv.innerHTML += `   ${test.name}: âœ… ì„±ê³µ\n`;
                    } catch (error) {
                        resultDiv.innerHTML += `   ${test.name}: âŒ ì‹¤íŒ¨ - ${error.message}\n`;
                    }

                    // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
                    const progress = ((i + 1) / totalTests) * 100;
                    progressBar.style.width = `${progress}%`;
                }

                resultDiv.innerHTML += `\nğŸ¯ ìµœì¢… ê²°ê³¼: ${passedTests}/${totalTests} í…ŒìŠ¤íŠ¸ í†µê³¼\n\n`;
                
                if (passedTests === totalTests) {
                    resultDiv.innerHTML += 'ğŸ‰ ëª¨ë“  í…ŒìŠ¤íŠ¸ê°€ ì„±ê³µí–ˆìŠµë‹ˆë‹¤! ì‹¤ì œê°’ ì‹œìŠ¤í…œì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤.\n';
                    resultDiv.className = 'result-box success';
                } else {
                    resultDiv.innerHTML += `âš ï¸ ${totalTests - passedTests}ê°œ í…ŒìŠ¤íŠ¸ê°€ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\n`;
                    resultDiv.className = 'result-box error';
                }
            }
        }

        // ì „ì—­ í•¨ìˆ˜ë“¤
        const tester = new RealValueAPITesterV2();

        function checkAllServers() {
            tester.checkAllServers();
        }

        function testRPPGAPI() {
            tester.testRPPGAPI();
        }

        function testVoiceAPI() {
            tester.testVoiceAPI();
        }

        function runFullSystemTest() {
            tester.runFullSystemTest();
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ ì„œë²„ ìƒíƒœ í™•ì¸
        window.addEventListener('load', () => {
            tester.checkAllServers();
        });
    </script>
</body>
</html> 