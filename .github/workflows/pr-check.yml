name: PR Quality Check

on:
  pull_request:
    branches: [ main, develop ]

jobs:
  quality-check:
    runs-on: ubuntu-latest
    timeout-minutes: 15
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: Install dependencies
      run: |
        if [ -f "frontend/package.json" ]; then
          cd frontend
          npm ci
        else
          echo "âŒ No frontend/package.json found"
          exit 1
        fi
        
    - name: Check for critical errors
      run: |
        cd frontend
        echo "ğŸ” Checking for critical errors..."
        
        # TypeScript ì»´íŒŒì¼ ì—ëŸ¬ ì²´í¬
        if ! npm run type-check; then
          echo "âŒ TypeScript compilation errors found"
          exit 1
        fi
        
        # ESLint ì—ëŸ¬ ì²´í¬ (ê²½ê³ ëŠ” ë¬´ì‹œ)
        if npm run lint 2>&1 | grep -q "error"; then
          echo "âŒ ESLint errors found"
          exit 1
        fi
        
        echo "âœ… No critical errors found"
        
    - name: Build test
      run: |
        cd frontend
        echo "ğŸ”¨ Testing build process..."
        if ! npm run build; then
          echo "âŒ Build failed"
          exit 1
        fi
        echo "âœ… Build successful"
        
    - name: Check file structure
      run: |
        echo "ğŸ“ Checking file structure..."
        
        # í•„ìˆ˜ íŒŒì¼ë“¤ ì²´í¬
        required_files=(
          "frontend/package.json"
          "frontend/next.config.js"
          "firebase.json"
          ".firebaserc"
        )
        
        for file in "${required_files[@]}"; do
          if [ ! -f "$file" ]; then
            echo "âŒ Required file missing: $file"
            exit 1
          fi
        done
        
        echo "âœ… File structure check passed"
        
    - name: Success
      run: |
        echo "ğŸ‰ PR Quality Check passed!"
        echo "âœ… All critical checks completed successfully"
        echo "âœ… Ready for merge"
