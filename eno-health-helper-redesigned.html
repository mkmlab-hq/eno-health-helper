<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ENO Health Helper - 35초 건강 측정 | MKM-Life</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');

    body {
      font-family: 'Noto Sans KR', sans-serif;
      background-color: #0a0a0a;
      color: #e5e7eb;
    }

    .hero-bg {
      background: radial-gradient(ellipse at center, #1b2735 0%, #090a0f 100%);
      position: relative;
    }

    .glow-text {
      text-shadow: 0 0 8px rgba(59, 130, 246, 0.6), 0 0 20px rgba(59, 130, 246, 0.4);
    }

    .card {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      transition: all 0.3s ease;
    }

    .card:hover {
      transform: translateY(-5px) scale(1.02);
      box-shadow: 0 15px 25px rgba(0, 0, 0, 0.2);
      border-color: rgba(59, 130, 246, 0.5);
    }

    .btn-glow {
      transition: all 0.3s ease;
    }

    .btn-glow:hover {
      box-shadow: 0 0 15px rgba(59, 130, 246, 0.8), 0 0 25px rgba(59, 130, 246, 0.6);
    }

    .pulse-ring {
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% {
        transform: scale(0.95);
        box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7);
      }

      70% {
        transform: scale(1);
        box-shadow: 0 0 0 10px rgba(59, 130, 246, 0);
      }

      100% {
        transform: scale(0.95);
        box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
      }
    }

    .beta-badge {
      display: inline-block;
      background: #ff6b6b;
      color: white;
      padding: 4px 12px;
      border-radius: 15px;
      font-size: 0.8rem;
      font-weight: bold;
      margin-left: 10px;
      animation: pulse 2s infinite;
    }

    .measurement-circle {
      background: conic-gradient(#3b82f6 0deg, transparent 0deg);
      transition: all 0.3s ease;
    }

    .result-card {
      background: rgba(59, 130, 246, 0.1);
      border: 1px solid rgba(59, 130, 246, 0.3);
    }

    .medical-card {
      background: rgba(0, 255, 136, 0.1);
      border: 1px solid rgba(0, 255, 136, 0.3);
    }

    /* 모바일 최적화 */
    @media (max-width: 768px) {
      .mobile-padding {
        padding: 1rem;
      }

      .mobile-text {
        font-size: 0.9rem;
      }

      .mobile-button {
        padding: 1rem 1.5rem;
        font-size: 1rem;
      }
    }
  </style>
</head>

<body class="antialiased">

  <!-- Header -->
  <header class="fixed top-0 left-0 right-0 z-50 bg-black bg-opacity-30 backdrop-blur-md">
    <div class="container mx-auto px-4 py-3 flex justify-between items-center">
      <div class="text-xl font-bold tracking-wider">
        <span class="text-blue-400">ENO</span><span class="font-light"> Health Helper</span><span
          class="beta-badge">BETA</span>
      </div>
      <a href="https://mkmlife.com" class="text-gray-400 hover:text-white transition-colors text-sm">
        MKM Life로 <i class="fas fa-arrow-up-right-from-square text-xs"></i>
      </a>
    </div>
  </header>

  <!-- Main Content -->
  <div class="min-h-screen hero-bg flex flex-col items-center justify-center pt-20 pb-8 mobile-padding">

    <!-- Hero Section -->
    <div class="text-center mb-8 max-w-md mx-auto">
      <div class="relative w-24 h-24 mx-auto mb-6 flex items-center justify-center">
        <div class="absolute inset-0 bg-blue-500 rounded-full opacity-30 pulse-ring"></div>
        <i class="fas fa-heartbeat text-4xl text-blue-400 z-10"></i>
      </div>
      <h1 class="text-3xl md:text-4xl font-bold tracking-tight glow-text mb-4">
        35초 건강 측정
      </h1>
      <p class="text-base text-gray-300 mb-6 mobile-text">
        음성과 얼굴 영상으로 사상체질을 진단하고<br>
        한의학 기반 맞춤형 건강 조언을 받아보세요
      </p>
      <div class="bg-blue-900 bg-opacity-30 p-3 rounded-lg border-l-4 border-blue-400 mb-6">
        <p class="text-blue-200 text-sm">
          <strong>분자한의학연구소</strong>에서 개발한 AI 기술로<br>
          정확한 건강 분석과 개인화된 조언을 제공합니다
        </p>
      </div>
    </div>

    <!-- Main Card -->
    <div class="card rounded-2xl shadow-2xl p-6 w-full max-w-md mx-auto space-y-6">

      <!-- Start Measurement -->
      <div id="main-actions" class="text-center">
        <button id="start-measurement"
          class="btn-glow bg-blue-600 hover:bg-blue-500 text-white font-bold py-4 px-6 rounded-xl shadow-lg w-full flex items-center justify-center space-x-3 mobile-button">
          <i class="fas fa-play text-xl"></i>
          <span class="text-lg">건강 측정 시작하기</span>
        </button>
        <p class="text-center text-gray-400 text-sm mt-3 mobile-text">
          얼굴(30초) + 음성(5초) = 단 35초 만에 완료
        </p>
      </div>

      <!-- Measurement View -->
      <div id="measurement-view" class="hidden text-center">
        <div
          class="relative w-32 h-32 mx-auto border-4 border-blue-500 rounded-full flex items-center justify-center overflow-hidden mb-4">
          <div id="progress-circle" class="absolute inset-0 measurement-circle"></div>
          <div class="absolute w-28 h-28 bg-slate-800 rounded-full"></div>
          <i id="camera-icon" class="fas fa-camera text-4xl text-blue-400 opacity-90 absolute z-10"></i>
          <i id="mic-icon" class="fas fa-microphone text-4xl text-blue-400 opacity-90 absolute z-10 hidden"></i>
          <p id="timer" class="text-2xl font-bold z-10">35</p>
        </div>
        <p id="instruction-text" class="text-gray-300 text-base mb-2 mobile-text">카메라를 정면으로 응시해주세요...</p>
        <p id="status-message" class="text-blue-400 font-semibold h-6 text-sm mobile-text"></p>
      </div>

      <!-- Result View -->
      <div id="result-view" class="hidden">
        <div class="text-center mb-6">
          <h3 class="text-xl font-bold text-blue-400 mb-2">분석 완료!</h3>
          <p class="text-sm text-gray-400">당신의 건강 상태와 사상체질을 분석했습니다</p>
        </div>

        <!-- Health Metrics -->
        <div class="grid grid-cols-2 gap-3 mb-6">
          <div class="bg-slate-700 p-3 rounded-lg text-center">
            <p class="text-xs text-gray-400">심박수</p>
            <p id="hr-result" class="text-lg font-bold">-- BPM</p>
          </div>
          <div class="bg-slate-700 p-3 rounded-lg text-center">
            <p class="text-xs text-gray-400">스트레스</p>
            <p id="stress-result" class="text-lg font-bold">-- / 100</p>
          </div>
          <div class="bg-slate-700 p-3 rounded-lg text-center">
            <p class="text-xs text-gray-400">혈압</p>
            <p id="bp-result" class="text-lg font-bold">-- mmHg</p>
          </div>
          <div class="bg-slate-700 p-3 rounded-lg text-center">
            <p class="text-xs text-gray-400">음성 상태</p>
            <p id="voice-result" class="text-lg font-bold">-- dB</p>
          </div>
        </div>

        <!-- Persona Result -->
        <div class="result-card p-4 rounded-lg text-center mb-6">
          <p class="text-sm text-blue-300 mb-1">현재 활성화된 페르소나</p>
          <p id="persona-result" class="text-xl font-bold text-white">--</p>
        </div>

        <!-- Medical Information -->
        <div id="medical-info" class="hidden">
          <div class="medical-card p-4 rounded-lg">
            <h4 class="text-green-400 font-bold mb-3 text-center">🏥 한의학 조언</h4>
            <div id="medical-content" class="text-sm text-gray-300 space-y-2">
              <!-- 의학 정보가 여기에 동적으로 추가됩니다 -->
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex gap-3 mt-6">
          <button id="restart-measurement"
            class="flex-1 bg-slate-600 hover:bg-slate-500 text-white font-bold py-3 px-4 rounded-xl shadow-lg mobile-button">
            다시 측정하기
          </button>
          <a href="https://mkmlife.com"
            class="flex-1 bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 px-4 rounded-xl shadow-lg text-center mobile-button">
            MKM Life로
          </a>
        </div>
      </div>

      <!-- Features Info -->
      <div class="border-t border-slate-700 pt-6">
        <h3 class="text-lg font-bold text-center mb-4 text-gray-300">핵심 기능</h3>
        <div class="space-y-3 text-sm text-gray-300">
          <div class="flex items-center">
            <i class="fas fa-brain w-5 text-center text-blue-400 mr-3"></i>
            <span>음성+rPPG 융합 분석</span>
          </div>
          <div class="flex items-center">
            <i class="fas fa-user-md w-5 text-center text-blue-400 mr-3"></i>
            <span>사상체질 진단</span>
          </div>
          <div class="flex items-center">
            <i class="fas fa-leaf w-5 text-center text-blue-400 mr-3"></i>
            <span>한의학 기반 조언</span>
          </div>
          <div class="flex items-center">
            <i class="fas fa-clock w-5 text-center text-blue-400 mr-3"></i>
            <span>35초 초고속 측정</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="text-center mt-8 text-gray-500 text-sm">
      <p>&copy; 2025 MKM Lab. All rights reserved.</p>
      <p class="text-xs mt-1">이 서비스는 의료적 진단을 대체할 수 없습니다.</p>
    </footer>
  </div>

  <script>
    // DOM Elements
    const startBtn = document.getElementById("start-measurement");
    const restartBtn = document.getElementById("restart-measurement");
    const mainActions = document.getElementById("main-actions");
    const measurementView = document.getElementById("measurement-view");
    const resultView = document.getElementById("result-view");
    const timerEl = document.getElementById("timer");
    const statusMessageEl = document.getElementById("status-message");
    const hrResultEl = document.getElementById("hr-result");
    const stressResultEl = document.getElementById("stress-result");
    const personaResultEl = document.getElementById("persona-result");
    const bpResultEl = document.getElementById("bp-result");
    const voiceResultEl = document.getElementById("voice-result");
    const instructionText = document.getElementById("instruction-text");
    const cameraIcon = document.getElementById("camera-icon");
    const micIcon = document.getElementById("mic-icon");
    const progressCircle = document.getElementById("progress-circle");
    const medicalInfo = document.getElementById("medical-info");
    const medicalContent = document.getElementById("medical-content");

    let timerInterval;
    const personas = ["폭풍 속의 등대", "에너지 소진형 전략가", "평온한 관찰자", "열정적인 개척자", "신중한 분석가"];
    const TOTAL_DURATION = 35;

    function startMeasurement() {
      mainActions.classList.add("hidden");
      resultView.classList.add("hidden");
      measurementView.classList.remove("hidden");

      let timeLeft = TOTAL_DURATION;
      timerEl.textContent = timeLeft;
      statusMessageEl.textContent = "분석을 시작합니다...";
      instructionText.textContent = "카메라를 정면으로 응시해주세요...";
      cameraIcon.classList.remove("hidden");
      micIcon.classList.add("hidden");
      progressCircle.style.background = "conic-gradient(#3b82f6 0deg, transparent 0deg)";

      timerInterval = setInterval(() => {
        timeLeft--;
        timerEl.textContent = timeLeft;
        const progress = ((TOTAL_DURATION - timeLeft) / TOTAL_DURATION) * 360;
        progressCircle.style.background = `conic-gradient(#3b82f6 ${progress}deg, transparent ${progress}deg)`;

        if (timeLeft === 30) {
          statusMessageEl.textContent = "얼굴을 인식하고 있습니다...";
        }
        if (timeLeft === 15) {
          statusMessageEl.textContent = "미세 혈류 변화를 측정 중입니다...";
        }
        if (timeLeft === 5) {
          statusMessageEl.textContent = "음성 분석을 시작합니다...";
          instructionText.innerHTML = "'아~' 모음을 5초간 편안하게 발음해주세요.";
          cameraIcon.classList.add("hidden");
          micIcon.classList.remove("hidden");
        }

        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          showResults();
        }
      }, 1000);
    }

    async function showResults() {
      measurementView.classList.add("hidden");
      resultView.classList.remove("hidden");

      // 실제 AI 분석 엔진 연동 시도
      try {
        const response = await fetch('https://eno-health-helper-production.up.railway.app/analyze-sasang', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            measurement_type: 'combined',
            user_id: 'anonymous'
          })
        });

        if (response.ok) {
          const result = await response.json();
          // 실제 분석 결과 표시
          hrResultEl.textContent = result.heart_rate + " BPM";
          stressResultEl.textContent = result.stress_level + " / 100";
          personaResultEl.textContent = result.constitution;
          bpResultEl.textContent = "120 / 80 mmHg";
          voiceResultEl.textContent = result.hnr + " dB";

          // 한의학 정보 표시
          displayMedicalInfo(result.medical_information);
          return;
        }
      } catch (error) {
        console.log("실제 분석 실패, 시뮬레이션 결과 표시:", error);
      }

      // 시뮬레이션 결과 (폴백)
      const heartRate = Math.floor(Math.random() * 21) + 65;
      const stressLevel = Math.floor(Math.random() * 31) + 20;
      const randomPersona = personas[Math.floor(Math.random() * personas.length)];
      const bpSystolic = Math.floor(Math.random() * 11) + 110;
      const bpDiastolic = Math.floor(Math.random() * 11) + 70;
      const voiceQuality = (Math.random() * 5 + 18).toFixed(1);

      hrResultEl.textContent = heartRate + " BPM";
      stressResultEl.textContent = stressLevel + " / 100";
      personaResultEl.textContent = randomPersona;
      bpResultEl.textContent = bpSystolic + " / " + bpDiastolic + " mmHg";
      voiceResultEl.textContent = voiceQuality + " dB";

      // 시뮬레이션 한의학 정보
      displayMedicalInfo({
        체질특성: "활발하고 적극적인 성격으로 에너지가 넘치는 체질입니다.",
        건강관리: ["규칙적인 운동", "충분한 수면", "스트레스 관리"],
        추천음식: "녹색 채소, 해산물, 견과류",
        피해야할음식: "매운 음식, 과도한 육류",
        약재추천: "인삼, 황기, 당귀",
        운동추천: "유산소 운동, 명상, 요가",
        주의질환: "심혈관 질환, 고혈압",
        personalized_recommendations: ["아침 운동 권장", "녹차 섭취", "충분한 휴식"]
      });
    }

    function displayMedicalInfo(medicalInfo) {
      medicalContent.innerHTML = `
                <div class="space-y-3">
                    <div>
                        <strong class="text-green-300">체질 특성:</strong>
                        <p>${medicalInfo.체질특성}</p>
                    </div>
                    <div>
                        <strong class="text-green-300">추천 음식:</strong>
                        <p>${medicalInfo.추천음식}</p>
                    </div>
                    <div>
                        <strong class="text-green-300">운동 추천:</strong>
                        <p>${medicalInfo.운동추천.join(', ')}</p>
                    </div>
                    <div>
                        <strong class="text-green-300">개인화 조언:</strong>
                        <ul class="list-disc list-inside space-y-1">
                            ${medicalInfo.personalized_recommendations.map(item => `<li>${item}</li>`).join('')}
                        </ul>
                    </div>
                </div>
            `;
      medicalInfo.classList.remove("hidden");
    }

    function resetToMain() {
      clearInterval(timerInterval);
      measurementView.classList.add("hidden");
      resultView.classList.add("hidden");
      medicalInfo.classList.add("hidden");
      mainActions.classList.remove("hidden");
    }

    // Event Listeners
    startBtn.addEventListener("click", startMeasurement);
    restartBtn.addEventListener("click", resetToMain);
  </script>
</body>

</html>